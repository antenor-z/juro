<!DOCTYPE html>
<html>

<head>
    <title>Calculadora de Juros</title>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <link rel="stylesheet" href="/static/style.css">
</head>

<body id="body">
    <container>
        <div class="form-container">
            <label for="initial">Saldo inicial ($)</label>
            <input type="text" id="initial" placeholder="10000.00">
            <label for="interest">Juros (%)</label>
            <input type="text" id="interest" placeholder="12.36%">
            <div style="display: block;">
                <input type="radio" id="interest_year" name="interest_unit" value="year" checked>
                <label for="interest_year">a.a.</label>
                <input type="radio" id="interest_month" name="interest_unit" value="month">
                <label for="interest_month">a.m.</label>
            </div>
            <label for="time">Tempo</label>
            <input type="text" id="time" placeholder="1">
            <div style="display: block;">
                <input type="radio" id="time_year" name="time_unit" value="year" checked>
                <label for="time_year">ano(s)</label>
                <input type="radio" id="time_month" name="time_unit" value="month">
                <label for="time_month">mês(es)</label>
            </div>

            <label for="contribution">Aporte mensal ($)</label>
            <input type="text" id="contribution" placeholder="0">
            <button onclick="calc()">Calcular</button>
        </div>
    </container>

    <script>
        function calc() {
            const initial = parseFloat(document.getElementById("initial").value)
            const interest = parseFloat(document.getElementById("interest").value) / 100
            const time = parseFloat(document.getElementById("time").value)
            const contribution = parseFloat(document.getElementById("contribution").value)

            const interest_unit = document.querySelector('input[name="interest_unit"]:checked').value;
            const time_unit = document.querySelector('input[name="time_unit"]:checked').value;

            const params = new URLSearchParams(
                {
                    initial: initial,
                    interest: interest,
                    interest_unit: interest_unit,
                    time: time,
                    time_unit: time_unit,
                    contribution: contribution ? contribution : 0.0,
                })

            fetch(`/juro?${params.toString()}`)
                .then(response => response.json())
                .then(data => { 
                    const resultsTableOld = document.getElementById("results-table")
                    if (resultsTableOld !== null) {
                        resultsTableOld.remove()
                    }
                    const resultsTable = document.createElement("table")
                    resultsTable.id = "results-table"

                    const tHeader = document.createElement("tr")
                    const monthH = document.createElement("th")
                    monthH.innerText = "Mês"
                    const investedH = document.createElement("th")
                    investedH.innerText = "Investido"
                    const acumulatedH = document.createElement("th")
                    acumulatedH.innerText = "Acumulado"
                    const increaseH = document.createElement("th")
                    increaseH.innerText = "Aumento"
                    const increase_interestH = document.createElement("th")
                    increase_interestH.innerText = "Juros"

                    tHeader.appendChild(monthH)
                    tHeader.appendChild(investedH)
                    tHeader.appendChild(acumulatedH)
                    tHeader.appendChild(increaseH)
                    tHeader.appendChild(increase_interestH)
                    resultsTable.appendChild(tHeader)


                    data.forEach(element => {
                        const row = document.createElement("tr")
                        const month = document.createElement("td")
                        month.innerText = element.month
                        const invested = document.createElement("td")

                        invested.innerText = element.invested
                            .toLocaleString("en-US", { maximumFractionDigits: 2, minimumFractionDigits: 2 })
                        const acumulated = document.createElement("td")
                        acumulated.innerText = element.acumulated
                            .toLocaleString("en-US", { maximumFractionDigits: 2, minimumFractionDigits: 2 })
                        const increase = document.createElement("td")
                        increase.innerText = element.increase
                            .toLocaleString("en-US", { maximumFractionDigits: 2, minimumFractionDigits: 2 })
                        const increaseInterest = document.createElement("td")
                        increaseInterest.innerText = element.increase_interest
                            .toLocaleString("en-US", { maximumFractionDigits: 2, minimumFractionDigits: 2 })

                        row.appendChild(month)
                        row.appendChild(invested)
                        row.appendChild(acumulated)
                        row.appendChild(increase)
                        row.appendChild(increaseInterest)

                        resultsTable.appendChild(row)
                    });

                    document.getElementsByTagName("container")[0].appendChild(resultsTable)
                })
            }
    </script>
</body>

</html>